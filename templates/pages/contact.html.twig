{% extends 'layouts/base.html.twig' %}

{% block title %}Contact{% endblock %}

{% block body %}
    <div class="banniere">
        <div class="banniere-content">
            CONTACT
        </div>
    </div>
    <div class="container container-info text-center">
        <h3 class="p-4">Vous avez des questions sur le jeu ? Vous souhaitez l'obtenir ? <br/><br/>Contactez-nous ici :</h3>
    </div>
    <div class="container contact-form">
        <form id="contactForm">
            <div class="mb-3 d-flex gap-2">
                <input type="text" class="form-control" id="name" name="name" placeholder="Nom" required>
                <input type="text" class="form-control" id="firstname" name="firstname" placeholder="Prénom" required>
            </div>
            <div class="mb-3">
                <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
            </div>
            <div class="radio-form">
                <div class="form-check">
                    <br/><h5 class="text-center">Quelle boîte possédez-vous ?</h5><br/>
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="RadioGrecMeso" value="Grec VS Mésopotamiens" required>
                    <label class="form-check-label" for="RadioGrecMeso">Grec VS Mésopotamiens</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="RadioEgySlave" value="Egyptien VS Slave">
                    <label class="form-check-label" for="RadioEgySlave">Egyptien VS Slave</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="RadioBoth" value="Les deux">
                    <label class="form-check-label" for="RadioBoth">Les deux !</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="RadioNone" value="Je n'ai pas encore le jeu" checked>
                    <label class="form-check-label" for="RadioNone">Je n'ai pas encore le jeu</label>
                </div><br/>
            </div>
            <div class="mb-3">
                <textarea class="form-control" id="message" name="message" rows="3" placeholder="Écrivez votre message..." required></textarea>
            </div>
            <button type="submit" class="btn text-center text-white">Envoyer</button>
        </form>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="messageModal" tabindex="-1" role="dialog" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messageModalLabel" style="color: black;">Notification</h5>
                </div>
                <div class="modal-body"> <!-- Ajout du style ici -->
                    <p id="modalMessage"  style="color: black;"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('contactForm');

            form.addEventListener('submit', function(event) {
                event.preventDefault(); // Empêche le rechargement de la page

                const formData = new FormData(form);

                fetch("{{ path('contact_submit') }}", {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    const modalMessageElement = document.getElementById('modalMessage');
                    const messageModal = new bootstrap.Modal(document.getElementById('messageModal'));

                    modalMessageElement.innerText = data.message;
                    messageModal.show();
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('modalMessage').innerText = 'Une erreur est survenue. Veuillez réessayer.';
                    new bootstrap.Modal(document.getElementById('messageModal')).show();
                });
            });

            {% if app.flashes('success') or app.flashes('error') %}
                const successMessage = "{{ app.session.flashBag.get('success') | first }}";
                const errorMessage = "{{ app.session.flashBag.get('error') | first }}";

                if (successMessage) {
                    document.getElementById('modalMessage').innerText = successMessage;
                    new bootstrap.Modal(document.getElementById('messageModal')).show();
                } else if (errorMessage) {
                    document.getElementById('modalMessage').innerText = errorMessage;
                    new bootstrap.Modal(document.getElementById('messageModal')).show();
                }
            {% endif %}
        });
    </script>

{% endblock %}
